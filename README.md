# 銀行 API 連携 3 日間チーム開発課題

本プロジェクトは、3 日間のチーム開発を通じて、外部 API（GMO あおぞらネット銀行様 Sunabar）の仕様を理解し、実際に API を組み込んだ Web アプリケーションを開発する課題です。

アプリケーションの企画・設計から、API 連携における技術的な問題解決、そしてチームでの共同作業まで、実践的な開発プロセスを学ぶことを目的としています。

---

## 1. 学習目的

この課題を通じて、以下の 3 つの主要な目的を達成することを目指しました。

1.  **外部 API の仕様理解と実践**

    - 外部企業が提供する銀行 API（Sunabar オープン API）の公式ドキュメントを読解し、認証方法、エンドポイント、リクエスト・レスポンス形式といった仕様への実践的な理解を深める。

2.  **API を利用したアプリケーション開発プロセスの体験**

    - 実際に銀行 API を利用したアプリケーション開発のプロセス（設計、実装、テスト、デバッグ）を体験し、一連の流れを掴む。特に、API 連携で発生しがちなエラーへの対処能力を養う。

3.  **チーム開発の体験**
    - Git/GitHub を用いたプルリクエストベースのチーム開発フローを体験する。
    - タスクの分担、進捗の共有、コードレビュー、マージといった共同作業における課題を発見し、解決していくプロセスを学ぶ。

---

## 2. 実装した機能の概要

上記の学習目的を達成するため、以下の機能を実装したアプリケーションを開発しました。

- **体重記録機能**: ユーザーが入力した体重をデータベース（PostgreSQL）に保存する。
- **残高照会機能**: 体重記録をトリガーに、Sunabar API へリクエストを送信し、リアルタイムで口座残高を取得する。
- **動的 UI**: 取得した残高や記録した体重を元に、画面の表示をリアルタイムで更新する。
- **結果のフィードバック**: 前回値との差分（体重の増減、残高の増加）を計算し、メッセージやキャラクター画像の変化でユーザーにフィードバックする。

---

## 3. 使用技術スタック

本課題では、モダンな Web 開発で広く採用されている以下の技術スタックを選定・学習しました。

| カテゴリ            | 技術                                    |
| :------------------ | :-------------------------------------- |
| **フロントエンド**  | Next.js (App Router), React, TypeScript |
| **UI/スタイリング** | TailwindCSS                             |
| **バックエンド**    | Next.js (API Routes)                    |
| **データベース**    | PostgreSQL                              |
| **ORM**             | Prisma                                  |
| **外部 API**        | GMO あおぞらネット銀行様 API (sunabar)  |

### 技術選定理由

Next.js でフロントエンドとバックエンドの両方を開発することにしたのは、開発速度とシンプルさを最優先した結果です。

今回の課題のように、小〜中規模のプロジェクトを短期間で開発する場合、この方法には大きなメリットがあります。以下に、それぞれの構成のメリット・デメリットを比較します。

<details>
### 案 1：Next.js で両方開発する（今回採用した方法）

フロントエンドの React コンポーネントと、バックエンドの API 機能（API Routes）を、同じ Next.js プロジェクト内に共存させる構成です。

#### メリット (Pros) 🚀

- **開発速度が速い**:
  - 一つのプロジェクト、一つの言語（TypeScript）、一つのフレームワークで完結するため、学習コストが低く、セットアップも非常に簡単です。
  - `npm run dev` という一つのコマンドで、フロントエンドとバックエンドの両方が同時に起動します。
- **フロントとバックの連携がスムーズ**:
  - 同じプロジェクト内にあるため、**型の共有が非常に簡単**です。例えば、API が返すデータの型を定義すれば、それをフロントエンドのコンポーネントでもそのまま利用でき、データの食い違いを防げます。
  - 開発中に CORS（オリジン間リソース共有）エラーに悩まされることがありません。
- **シンプルな構成**:
  - 管理するリポジトリやサーバーが一つで済むため、構成が非常にシンプルになります。デプロイ（公開）も一括で行えます。

#### デメリット (Cons) 🐌

- **バックエンドの機能制限**:
  - Next.js の API Routes は、Express.js のような専門のバックエンドフレームワークに比べ、複雑な処理（例: WebSocket、長時間のバックグラウンド処理）には向いていません。あくまでフロントエンドに付随する API を作るのに最適化されています。
- **密結合な構造**:
  - フロントエンドとバックエンドが密接に結びついているため、将来的にバックエンドだけを別の技術に置き換えたり、それぞれを独立してスケールさせたりすることが難しくなります。

### 案 2：フロント(Next.js)とバック(Express.js)を切り分ける

フロントエンド用の Next.js プロジェクトと、バックエンド API 用の Express.js プロジェクトを完全に分離して、それぞれを独立したサーバーとして動かす構成です。

#### メリット (Pros) 🏰

- **責務の明確な分離**:
  - フロントエンドチームとバックエンドチームが、互いの領域を気にすることなく、完全に独立して開発を進められます。
  - それぞれを独立してテストし、独立してデプロイできます。
- **バックエンドの専門性と自由度**:
  - バックエンドには、Express.js や NestJS、Go、Ruby on Rails など、プロジェクトの要件に最も適した技術を自由に選べます。より複雑で大規模なバックエンド処理に対応できます。
- **独立したスケーリング**:
  - API へのアクセスが急増した場合、バックエンドのサーバーだけを増強するといった、柔軟なインフラ管理が可能です。

#### デメリット (Cons) 🏗️

- **構成の複雑化**:
  - 管理するプロジェクトが 2 つになり、それぞれにビルドやデプロイのパイプラインが必要になります。
  - フロントとバックが別々の場所で動くため、CORS（オリジン間リソース共有）の設定や管理が必要になります。
- **開発速度の低下**:
  - 初期セットアップに時間がかかります。
  - フロントとバックで型を共有するには、モノレポ構成にするなど、追加の工夫が必要になり、開発のオーバーヘッドが増加します。

---

</details>

### 技術比較まとめ

| 観点                     | Next.js でフロント/バック開発  | フロントとバックを分離        |
| :----------------------- | :----------------------------- | :---------------------------- |
| **開発速度**             | **◎ 速い**                     | △ 遅い                        |
| **構成**                 | **◎ シンプル**                 | △ 複雑                        |
| **連携**                 | **◎ スムーズ（型の共有が楽）** | △ CORS や型の共有に工夫が必要 |
| **バックエンドの自由度** | △ 制限あり                     | **◎ 高い**                    |
| **スケーラビリティ**     | ◯                              | **◎ 柔軟**                    |

---

## 4. チーム開発で得られた学び

- **API 仕様の読解と試行錯誤の重要性**
  - ドキュメントだけでは読み取れない API の実際の挙動（必須ヘッダーやデータ型など）に対して、チームで仮説を立て、Postman などのツールを使って検証を繰り返すデバッグプロセスを学びました。
- **役割分担と密なコミュニケーション**
  - フロントエンド、バックエンド、API 連携といったタスクを分担しつつ、発生した問題や仕様の確認について、密に進捗を共有することの重要性を体験しました。
- **段階的な実装アプローチ**
  - 最初から全ての機能を実装するのではなく、まずは API との疎通、次に DB 連携、最後に UI というように、ステップバイステップで機能を積み上げていく開発アプローチの有効性を実感しました。

---

### 5. 工夫した点・技術的な挑戦

このアプリは、3 日間という短い期間で、以下の技術的な挑戦を乗り越えて実装しました。

- **１：外部 API との連携**:

  - 最大の挑戦は、**GMO あおぞらネット銀行の Sunabar というテスト用 API**との連携です。
  - 当初、API の仕様書解釈に苦しみエラーが頻発しましたが、一つずつ原因を切り分けてデバッグし、最終的に正常に動作する**残高照会 API**の実装に成功しました。

- **２：チーム開発**:

  - 初のチーム開発だったので、最初の認識合わせに多めに時間を使い、3 日間の計画、アプリの方向性、環境構築、github でどのようにデータを merge するか、までをハンズオンで確認してから開発をスタートしました。おおまかなルールをお互いに理解できていたので、大きな混乱なく進めることができました。
  - 毎朝とお昼、夕方に定期ミーティングを行ったのと別に、気になったことや相談があれば都度声をかけあってすり合わせを行いながら開発を進めました。

- **３：データベースの利用**:
  - 記録された体重データは、**PostgreSQL**データベースに**Prisma**という技術を使って安全に保存しています。これにより、データが消えることなく、将来的な機能拡張も可能になっています。

---

### 4. 今後の展望

今回は基本的な機能の実装に成功しましたが、将来的にはさらに発展させたいと考えています。

- **「ごほうびマネー」の自動振込機能**: 体重が目標を達成したら、設定した別口座からメイン口座へ**自動で「ごほうびマネー」が振り込まれる**仕組みの実装
- **データの可視化**: 記録した体重や残高の推移を**グラフで表示**して、ユーザーが自身の頑張りを長期的に振り返れるような機能の実装
- **ユーザー認証**: ログイン機能を実装し、複数のユーザーが自分だけのデータを使ってアプリを利用できるように拡張

---

## 5.改善点

今後の課題や、改善点は以下の通りです。

- **１：外部 API の仕様理解**:

  - **Sunabar オープン API**の API 仕様書解釈が浅かったことでエラーが頻発しました。
    また、当初予定していた挙動が仕様書では実装できないことが後半になってから判明し、方向性を変更しました。
    このようなことが実際の案件で発生すると混乱も大きくなるため、外部 API を利用する際には使用理解に十分な時間をかけるようにします。

- **２：チーム開発**:

  - プルリクエストの動作確認ができないと思い、開発担当者がテスト確認したもので OK としていましたが、
    レビュー担当者が git fetch origin コマンドや GitHub CLI を使えば動作確認できるということだったので、今後はレビュー時に動作確認まで行います。

- ## **３：help の活用**:
  - API の仕様など、もっと早い段階で help を出せていれば開発スピードも上がった。これは最初の段階での API 仕様理解度の低さも要因なので、開発初期段階で適切な help を出せるように取り組んでいきます。

## 6. 成功のためのキーポイント 🔑

1.  **毎朝のミーティング (朝会) の実施**
    - 作業開始前に 5 分、「昨日やったこと」「今日やること」「困っていること」を共有する。
2.  **API 仕様書の作成**
    - 最初に API のリクエストとレスポンスの形（JSON の構造など）をテキストで合意しておく。
3.  **迅速な相談**
    - 30 分以上一人で悩んだら、すぐにペアに相談する。短期開発では時間が最も重要。
