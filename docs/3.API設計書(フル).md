# API 設計書 (フル機能版・簡易表示形式)

本ドキュメントは、「マネーフィット」アプリケーションのフル機能版における API 仕様を定義します。

---

## 1. 基本事項

- **ベース URL:** `/api/v1`

- **認証方式:** **JWT (JSON Web Token)** を利用した認証。

  - ユーザーがログインに成功すると、サーバーは JWT を含んだ `HttpOnly` の Cookie を発行します。
  - 以降の認証が必要なリクエストでは、ブラウザが自動的に Cookie を送信するため、フロントエンド側でトークンを意識する必要はありません。

- **レスポンス形式:**
  - **成功時 (`2xx`):** `{ "data": { ... } }`
  - **失敗時 (`4xx`, `5xx`):** `{ "error": { "message": "..." } }`

---

## 2. エンドポイント一覧

### 認証 (`/auth`)

#### `POST /auth/register`

新規ユーザーを登録します。

- **認証:** 不要
- **リクエストボディ:**
  - `email` (String, 必須): ユーザーのメールアドレス
  - `password` (String, 必須): パスワード (8 文字以上)
- **成功レスポンス (`201 Created`):**

```json
{
  "data": {
    "id": "clxpf2rdt000008l5he0g1111",
    "email": "user@example.com"
  }
}
POST /auth/login
ユーザーを認証し、ログインセッションを開始します。

認証: 不要

リクエストボディ:

email (String, 必須): ユーザーのメールアドレス

password (String, 必須): パスワード

成功レスポンス (200 OK):

HttpOnly Cookieに認証トークンがセットされ、レスポンスボディにユーザー情報が返されます。

JSON

{
  "data": {
    "id": "clxpf2rdt000008l5he0g1111",
    "email": "user@example.com"
  }
}
POST /auth/logout
ユーザーをログアウトさせ、セッションを終了します。

認証: 必要

成功レスポンス (200 OK):

HttpOnly Cookieがクリアされます。

JSON

{
  "data": {
    "message": "ログアウトしました"
  }
}
ユーザー (/users)
GET /users/me
現在ログインしているユーザーの情報を取得します。

認証: 必要

成功レスポンス (200 OK):

JSON

{
  "data": {
    "id": "clxpf2rdt000008l5he0g1111",
    "email": "user@example.com",
    "initialWeight": 80.5,
    "targetWeight": 75.0
  }
}
PUT /users/me/profile
ログインユーザーのプロフィール（初期体重・目標体重）を更新します。

認証: 必要

リクエストボディ:

initialWeight (Number, 任意): 初期体重

targetWeight (Number, 任意): 目標体重

成功レスポンス (200 OK):

JSON

{
  "data": {
    "id": "clxpf2rdt000008l5he0g1111",
    "email": "user@example.com",
    "initialWeight": 82.0,
    "targetWeight": 76.0
  }
}
体重記録 (/weights)
POST /weights
今日の体重を記録します。このAPIの内部でsunabar API連携（擬似入金）が実行されます。

認証: 必要

リクエストボディ:

weight (Number, 必須): 今日の体重

成功レスポンス (201 Created):

JSON

{
  "data": {
    "logId": "clxpf8z0p000108l58s1l5k6k",
    "weight": 79.8,
    "date": "2025-09-24T10:00:00.000Z",
    "newBalance": 110000,
    "depositAmount": 10000
  }
}
GET /weights
ログインユーザーの過去の体重記録を全て取得します（グラフ表示用）。

認証: 必要

成功レスポンス (200 OK):

JSON

{
  "data": [
    {
      "id": "clxpf8z0p000108l58s1l5k6k",
      "weight": 79.8,
      "date": "2025-09-24T10:00:00.000Z"
    },
    {
      "id": "clxov8d1m000108l3e9k9z1z1",
      "weight": 80.5,
      "date": "2025-09-23T09:00:00.000Z"
    }
  ]
}
ダッシュボード (/dashboard)
GET /dashboard
ダッシュボード画面に必要な情報をまとめて取得します。

認証: 必要

成功レスポンス (200 OK):

このAPIは、ユーザー情報、最新の体重、目標達成率、最新の口座残高などを内部でまとめて取得し、一括で返します。

JSON

{
  "data": {
    "user": {
      "email": "user@example.com",
      "initialWeight": 80.5,
      "targetWeight": 75.0
    },
    "latestWeight": 79.8,
    "progressPercentage": 12.7,
    "currentBalance": 110000
  }
}
```
